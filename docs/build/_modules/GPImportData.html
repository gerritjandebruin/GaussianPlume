

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>GPImportData &mdash; GaussianPlume 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GaussianPlume
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"></div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GaussianPlume</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Module code</a> &raquo;</li>
        
      <li>GPImportData</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for GPImportData</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Data comes in three forms:</span>

<span class="sd">* Measurement data: this is recorded often, typically automatically</span>
<span class="sd">* Dynamic parameters: parameters that change a few times during a measurement. Maybe the terrain roughness. </span>
<span class="sd">* Static parameters: parameters that do no change during a measurement, for example the type of device used.  </span>

<span class="sd">Measurement data is similar to dynamic parameters, but changes more frequently. Measurement data is recorded automatically, dynamic parameters are typed into an Excel spreadsheet. Temperature may be an edge case. If it is recorded automatically, it is measurement data. If it is recorded twice during a measurement it is a dynamic parameter. If it is recorded only once, it is a static parameter. </span>

<span class="sd">Dynamic and static parameters</span>
<span class="sd">=============================</span>
<span class="sd">Static parameters are stored in a sheet named `static parameters&#39; (the sheet names are important). Column A contains the parameter names, column B the parameter values. If a parameter name or value is missing, it is ignored.</span>

<span class="sd">This data:</span>

<span class="sd">============ =======</span>
<span class="sd">Device       TNO XYZ</span>
<span class="sd">Operator      </span>
<span class="sd">Stack height 5</span>
<span class="sd">============ =======</span>

<span class="sd">Will be read as:</span>

<span class="sd">============ =======</span>
<span class="sd">Device       TNO XYZ</span>
<span class="sd">Stack height 5</span>
<span class="sd">============ =======</span>

<span class="sd">Dynamic parameters are stored in a sheet named &quot;dynamic parameters&quot;. Column A contains a time stamp, the other columns the parameters. Row 1 contains the parameter names. The idea is that you only need to fill in the value of the parameter that has changed. If a value is missing, it will use the last valid value. If there is no last valid value it will be set to NaN. Note that data is not interpolated. </span>

<span class="sd">This data:</span>

<span class="sd">================ ========= =========</span>
<span class="sd">datetime         Roughness Windspeed</span>
<span class="sd">================ ========= =========</span>
<span class="sd">02/08/2018 7:00            5</span>
<span class="sd">02/08/2018 9:40  C         </span>
<span class="sd">02/08/2018 10:33           11</span>
<span class="sd">02/08/2018 11:22 E          	</span>
<span class="sd">02/08/2018 12:25 F         16</span>
<span class="sd">================ ========= =========</span>

<span class="sd">Will be read as:</span>

<span class="sd">================ ========= =========</span>
<span class="sd">datetime         Roughness Windspeed</span>
<span class="sd">================ ========= =========</span>
<span class="sd">02/08/2018 7:00  **NaN**   5</span>
<span class="sd">02/08/2018 9:40  C         **5**</span>
<span class="sd">02/08/2018 10:33 **C**     11</span>
<span class="sd">02/08/2018 11:22 E         **11**	</span>
<span class="sd">02/08/2018 12:25 F         16</span>
<span class="sd">================ ========= =========</span>

<span class="sd">Note that if a dynamic parameter value is recorded only once, it effectively becomes a static parameter, but as explained in the Technical details, it is treated differently. </span>

<span class="sd">Technical details</span>
<span class="sd">=================</span>
<span class="sd">Data is treated as numpy-arrays (ndarrays) or as a number (integer, float). Numpy works similar to Matlab. You can multiply two ndarrays of the same size, to get a ndarray with the same size. You can also multiply an ndarray with a number, to get an ndarray with the same size:</span>

<span class="sd">* distance (ndarray with size = n) / windspeed (ndarray with size = n) = time (ndarray with size = n)</span>
<span class="sd">* distance (number) / windspeed (ndarray with size = n) = time (ndarray with size = n)</span>
<span class="sd">* distance (ndarray with size = n) / windspeed (number) = time (ndarray with size = n)</span>
<span class="sd">* distance (number) / windspeed (number) = time (number)</span>

<span class="sd">Measurement data is an ndarray. A static parameter is a number. Dynamic parameters are changed into an ndarray of the same length as the measurement data. </span>


<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">warnings</span>
    

<div class="viewcode-block" id="import_measurement_parameters_excel"><a class="viewcode-back" href="../GPImportData.html#GPImportData.import_measurement_parameters_excel">[docs]</a><span class="k">def</span> <span class="nf">import_measurement_parameters_excel</span><span class="p">(</span><span class="n">paf</span><span class="p">,</span> <span class="n">static_parameters</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">dynamic_parameters</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import an Excel file with measurement parameters.</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    paf : pathlib.Path</span>
<span class="sd">        Path and filename of the Excel file with parameters</span>
<span class="sd">    static_parameters : bool (True) or str</span>
<span class="sd">        Read the fixed parameters sheet in the Excel file. If this is a string, it will be used as the sheet name.</span>
<span class="sd">    dynamic_parameters : bool (True) or str</span>
<span class="sd">        Read the dynamic parameters sheet in the Excel file. If this is a string, it will be used as the sheet name.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pandas dataframe or None</span>
<span class="sd">        DataFrame with static parameters. None if static_parameters is False</span>
<span class="sd">    Pandas dataframe or None</span>
<span class="sd">        DataFrame with dynamic parameters.None if dynamic_parameters is False</span>
<span class="sd">    </span>
<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ValueError</span>
<span class="sd">        If the sheet name is incorrect.</span>
<span class="sd">    UserWarning</span>
<span class="sd">        If the file is not found at the paf. </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPImportData.import_measurement_parameters_excel()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    paf (path and filename): </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paf</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    static_parameters: </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">static_parameters</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    dynamic_parameters: </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dynamic_parameters</span><span class="p">))</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">paf</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># for lazy people </span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GPImportData.import_measurement_parameters_excel(): please give paf (path and filename) as pathlib path, not as string: </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paf</span><span class="p">))</span>
        <span class="n">paf</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">paf</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">paf</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GPImportData.import_measurement_parameters_excel(): parameter file does not exist (at this location): </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paf</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">paf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="n">static_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">static_parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">sheetname</span> <span class="o">=</span> <span class="n">static_parameters</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sheetname</span> <span class="o">=</span> <span class="s2">&quot;static parameters&quot;</span>
        
            <span class="n">df_static</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">sheetname</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> 
            
            <span class="c1"># transpose data and make a new index</span>
            <span class="n">df_static</span> <span class="o">=</span> <span class="n">df_static</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            <span class="n">df_static</span> <span class="o">=</span> <span class="n">df_static</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
            
            <span class="c1"># remove parameters without a value</span>
            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">df_static</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">pandas</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">df_static</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">cl</span><span class="p">]):</span> 
                    <span class="n">df_static</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>            
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_static</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">dynamic_parameters</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dynamic_parameters</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">sheetname</span> <span class="o">=</span> <span class="n">dynamic_parameters</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sheetname</span> <span class="o">=</span> <span class="s2">&quot;dynamic parameters&quot;</span>        
        
            <span class="n">df_dynamic</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">sheetname</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span> 
            
            <span class="c1"># forward fill data</span>
            <span class="n">df_dynamic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;ffill&quot;</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_dynamic</span> <span class="o">=</span> <span class="kc">None</span>
          
    <span class="k">return</span> <span class="n">df_static</span><span class="p">,</span> <span class="n">df_dynamic</span></div>
            

    
<div class="viewcode-block" id="import_measurement_data"><a class="viewcode-back" href="../GPImportData.html#GPImportData.import_measurement_data">[docs]</a><span class="k">def</span> <span class="nf">import_measurement_data</span><span class="p">(</span><span class="n">paf</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Import csv with measurement data.</span>
<span class="sd">    </span>
<span class="sd">    Arguments</span>
<span class="sd">    ---------</span>
<span class="sd">    paf : pathlib.Path</span>
<span class="sd">        Path and filename of the Excel file with parameters</span>
<span class="sd">    static_parameters : bool (True) or str</span>
<span class="sd">        Read the fixed parameters sheet in the Excel file. If this is a string, it will be used as the sheet name.</span>
<span class="sd">    dynamic_parameters : bool (True) or str</span>
<span class="sd">        Read the dynamic parameters sheet in the Excel file. If this is a string, it will be used as the sheet name.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Pandas dataframe or None</span>
<span class="sd">        DataFrame with static parameters. None if static_parameters is False</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;GPImportData.import_measurement_data()&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    paf (path and filename): </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paf</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">paf</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># for lazy people </span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GPImportData.import_measurement_data(): please give paf (path and filename) as pathlib path, not as string: </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paf</span><span class="p">))</span>
        <span class="n">paf</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">paf</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">paf</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;GPImportData.import_measurement_data(): measurement file does not exist (at this location): </span><span class="si">{:}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">paf</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">paf</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">F</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span> 
    
    <span class="k">return</span> <span class="n">df</span></div>

    

    
    
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Robbert Bloem.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>